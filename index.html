<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Cương Ôn Tập Tin Học</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải thư viện icon (cho nút reset) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Sử dụng font Inter từ Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
        }

        /* --- Kiểu nút tùy chọn --- */
        .option-btn {
            transition: all 0.2s;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }

        /* --- Kiểu phản hồi --- */
        .correct {
            background-color: #dcfce7 !important; /* bg-green-100 */
            border-color: #22c55e !important; /* border-green-500 */
            color: #15803d; /* text-green-800 */
            font-weight: 600;
        }
        .incorrect {
            background-color: #fee2e2 !important; /* bg-red-100 */
            border-color: #ef4444 !important; /* border-red-500 */
            color: #b91c1c; /* text-red-800 */
            font-weight: 600;
        }

        /* --- Kiểu input tự luận/điền từ --- */
        .short-answer-input.correct {
            border-color: #22c55e;
            background-color: #dcfce7;
        }
        .short-answer-input.incorrect {
            border-color: #ef4444;
            background-color: #fee2e2;
        }

        /* --- Kiểu Đúng/Sai (TF) --- */
        .tf-input { display: none; }
        .tf-label {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: all 0.2s;
        }
        .tf-input:checked + .tf-label {
            background-color: #dbeafe; /* bg-blue-100 */
            border-color: #3b82f6; /* border-blue-500 */
            font-weight: 600;
        }
        .tf-input:disabled + .tf-label {
            cursor: not-allowed;
            opacity: 0.8;
        }
        .tf-label.correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #15803d;
        }
        .tf-label.incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #b91c1c;
        }

        /* --- Thẻ câu hỏi --- */
        .quiz-card {
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
            margin-bottom: 1.5rem; /* mb-6 */
            padding: 1.5rem; /* p-6 */
        }
        
        /* --- Nút Reset (cho từng câu) --- */
        .question-reset-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #6b7280; /* text-gray-500 */
            background: #f3f4f6; /* bg-gray-100 */
            border-radius: 9999px; /* rounded-full */
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .question-reset-btn:hover {
            color: #1f2937; /* text-gray-800 */
            background: #e5e7eb; /* bg-gray-200 */
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Thanh header cố định -->
    <header class="sticky top-0 z-50 bg-gray-100/95 backdrop-blur-sm shadow-md py-4">
        <div class="container max-w-3xl mx-auto px-4 sm:px-6 md:px-8">
            <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">Đề Cương Ôn Tập Tin Học</h1>

            <!-- Khu vực điều khiển tổng -->
            <div id="controls" class="flex flex-col sm:flex-row gap-2 justify-center mb-6">
                <button id="shuffle-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200 flex-1">
                    <i class="fas fa-random"></i> Đảo câu hỏi & đáp án
                </button>
                <button id="total-reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200 flex-1">
                    <i class="fas fa-sync-alt"></i> Reset tổng
                </button>
            </div>

            <!-- Khu vực tiến độ -->
            <div id="progress-container" class="bg-white p-4 rounded-lg shadow text-center">
                <span id="progress-text" class="text-lg font-medium text-gray-700">Đã hoàn thành: 0 / 38</span>
                <span class="mx-3 text-gray-300">|</span>
                <span id="score-tracker" class="text-lg font-medium text-red-600">Câu sai: 0</span>
            </div>
        </div>
    </header>

    <!-- Thân trang (nội dung cuộn) -->
    <main class="container max-w-3xl mx-auto p-4 sm:p-6 md:p-8">
        <!-- Khu vực câu hỏi -->
        <div id="quiz-container">
            <!-- Các câu hỏi sẽ được tải vào đây bằng JavaScript -->
        </div>
    </main>

    <script>
        // --- DỮ LIỆU CÂU HỎI ---
        const originalQuizData = [
            // --- Phần I: Trắc nghiệm (Từ ảnh 1 & 2 & 3) ---
            {
                type: 'mc',
                question: '1. Mạng không dây được kết nối bằng:',
                options: ['Bluetooth', 'Dây mạng', 'Cáp điện', 'Cáp quang'],
                answer: 'Bluetooth' // Đáp án A
            },
            {
                type: 'mc',
                question: '2. Thiết bị cơ bản của mạng có dây là:',
                options: ['Cáp mạng, Switch', 'Access Point, Modem', 'Switch, Modem', 'Access Point, cáp mạng'],
                answer: 'Cáp mạng, Switch' // *** ĐÃ SỬA *** (Đáp án A)
            },
            {
                type: 'mc',
                question: '3. Chiếc điều khiển ti vi vi điều khiển ti vi bằng gì?',
                options: ['Dây cáp', 'Bluetooth', 'Sóng điện từ', 'Mạng không dây'],
                answer: 'Sóng điện từ' // Đáp án C
            },
            {
                type: 'mc',
                question: '4. Đâu không phải là đặc điểm của cáp xoắn:',
                options: ['Lõi làm bằng chất liệu trong suốt', 'Truyền thông tin bằng dòng điện', 'Có một lớp vỏ bọc lại', 'Lõi đồng'],
                answer: 'Lõi làm bằng chất liệu trong suốt' // Đáp án A
            },
            {
                type: 'mc',
                question: '5. Hình dưới đây nói về thiết bị mạng nào?',
                imageNote: '(Hình ảnh gốc cho câu 5: Switch)',
                options: ['Modem', 'Cáp quang', 'Cáp xoắn', 'Switch'],
                answer: 'Switch' // Đáp án D
            },
            {
                type: 'mc',
                question: '6. Thiết bị nào sau đây là thiết bị kết nối mạng?',
                options: ['Cáp xoắn, máy quét, Switch.', 'Cáp xoắn, cáp quang, Switch, modem mạng.', 'Máy tính, Switch, modem mạng.', 'Máy in, cáp quang, Switch, modem mạng.'],
                answer: 'Cáp xoắn, cáp quang, Switch, modem mạng.' // Đáp án B
            },
            {
                type: 'mc',
                question: '7. Một mạng máy tính gồm',
                options: ['Tối thiểu năm máy tính được liên kết với nhau.', 'Một số máy tính.', 'Một nhóm các máy tính và thiết bị được kết nối để truyền dữ liệu', 'Tất cả các máy tính trong một phòng hoặc trong một nhà.'],
                answer: 'Một nhóm các máy tính và thiết bị được kết nối để truyền dữ liệu' // Đáp án C
            },
            {
                type: 'mc',
                question: '8. Mạng LAN là mạng kết nối dùng trong phạm vi:',
                options: ['Lớn', 'Vừa', 'Nhỏ', 'Trên toàn thế giới'],
                answer: 'Nhỏ' // Đáp án C
            },
            {
                type: 'mc',
                question: '9. Đơn vị đo dung lượng thông tin nhỏ nhất là gì?',
                options: ['Byte', 'Digit', 'Kilobyte', 'Bit'],
                answer: 'Byte' // *** ĐÃ SỬA *** (Đáp án A)
            },
            {
                type: 'mc',
                question: '10. Em hãy cho biết 1 KB = ? B',
                options: ['1024', '1022', '1025', '1023'],
                answer: '1024' // Đáp án A
            },
            {
                type: 'mc',
                question: '11. Chu trình xử lí thông tin của máy tính gồm những bước nào:',
                options: ['Xử lí đầu vào, xử lí dữ liệu, xử lí đầu ra', 'Xử lí đầu vào, xử lí đầu ra, xử lí dữ liệu', 'Xử lí dữ liệu, xử lí đầu vào, xử lí đầu ra', 'Xử lí đầu vào, xử lí dữ liệu ra, xử lí dữ liệu'],
                answer: 'Xử lí đầu vào, xử lí dữ liệu, xử lí đầu ra' // Đáp án A
            },
            {
                type: 'mc',
                question: '12. Thiết bị số nào dưới đây có khả năng lưu trữ dữ liệu?',
                options: ['Bàn phím', 'Chuột', 'Loa', 'Ổ đĩa cứng'],
                answer: 'Ổ đĩa cứng' // Đáp án D
            },
            {
                type: 'mc',
                question: '13. Bit là đơn vị nhỏ nhất dùng để:',
                options: ['Biểu diễn và lưu trữ thông tin', 'Biểu diễn các con số', 'Biểu diễn các chữ cái', 'Biểu diễn các hình ảnh'],
                answer: 'Biểu diễn và lưu trữ thông tin' // Đáp án A
            },
            {
                type: 'mc',
                question: '14. Biển báo sau chứa dữ liệu dạng gì?',
                imageNote: '(Hình ảnh gốc cho câu 14: Biển báo 3,5m)',
                options: ['Dạng hình ảnh', 'Dạng chữ', 'Dạng số', 'Dạng hình ảnh, chữ và số'],
                answer: 'Dạng hình ảnh, chữ và số' // Đáp án D
            },
            {
                type: 'mc',
                question: '15. Chú cảnh sát thổi còi và giơ gậy làm hiệu khi đèn giao thông chuyển sang màu đỏ. Em hãy cho biết thông tin đó có dạng gì?',
                options: ['Hình ảnh', 'Âm thanh', 'Hình ảnh và âm thanh', 'Chữ và âm thanh'],
                answer: 'Hình ảnh và âm thanh' // Đáp án C
            },
            {
                type: 'mc',
                question: '16. Thiết bị nào sau đây của máy tính được ví như bộ não của con người?',
                options: ['Màn hình', 'Chuột', 'Bàn phím', 'CPU'],
                answer: 'CPU' // Đáp án D
            },
            {
                type: 'mc',
                question: '17. Con người thu nhận thông tin trực tiếp nhờ:',
                options: ['Vật mang tin', 'Năm giác quan', 'Bộ não', 'Dữ liệu'],
                answer: 'Năm giác quan' // Đáp án B
            },
            {
                type: 'mc',
                question: '18. Em đi trên đường nhìn thấy băng chỉ đường. Vậy biển chỉ đường là:',
                options: ['Thông tin', 'Dữ liệu', 'Vật mang tin', 'Thông tin và dữ liệu'],
                answer: 'Vật mang tin' // Đáp án C
            },
            {
                type: 'mc',
                question: '19. Mỗi sáng, em đều nghe thấy chuông đồng hồ báo thức reo. Theo em, đó là thông tin dạng gì?',
                options: ['Dạng hình ảnh', 'Dạng số', 'Dạng âm thanh', 'Dạng chữ'],
                answer: 'Dạng âm thanh' // Đáp án C
            },
            {
                type: 'mc',
                question: '20. Trong khi điều tra, cảnh sát đã phán đoán, suy luận để chứng minh tội phạm. Hành động đó được gọi là:',
                options: ['Thu nhận thông tin', 'Xử lí thông tin', 'Truyền thông tin', 'Lưu trữ thông tin'],
                answer: 'Xử lí thông tin' // Đáp án B
            },
            {
                type: 'mc',
                question: '21. "Kĩ sư xem bản vẽ để chỉ huy xây dựng công trình". Theo em, vật mang tin trong tình huống này là gì?',
                options: ['Kĩ sư', 'Bộ não ghi nhớ thông tin của kĩ sư', 'Bản vẽ trên giấy', 'Công trình xây dựng'],
                answer: 'Bản vẽ trên giấy' // Đáp án C
            },
            {
                type: 'mc',
                question: '22. Biển báo sau chứa dữ liệu dạng gì?',
                imageNote: '(Hình ảnh gốc cho câu 22: Biển báo đường sắt)',
                options: ['Dạng hình ảnh', 'Dạng chữ', 'Dạng số', 'Dạng âm thanh'],
                answer: 'Dạng hình ảnh' // Đáp án A
            },
            {
                type: 'mc',
                question: '24. Mạng LAN là viết tắt của cụm từ nào?',
                options: ['Local Arian Network', 'Lomal Area Network', 'Local Area Nework', 'Local Area Network'],
                answer: 'Local Area Network' // Đáp án D
            },
            {
                type: 'mc',
                question: '25. Hình dưới đây nói về thiết bị mạng nào?',
                imageNote: '(Hình ảnh gốc cho câu 25: Modem)',
                options: ['Modem', 'Cáp quang', 'Cáp xoắn', 'Switch'],
                answer: 'Modem' // Đáp án A
            },
            {
                type: 'mc',
                question: '26. Thiết bị cơ bản của mạng có dây là:',
                options: ['Cáp mạng', 'Access Point', 'Switch', 'Cáp quang'],
                answer: 'Access Point' // Đáp án B (Dựa trên ảnh 3)
            },
            {
                type: 'mc',
                question: '27. Hình dưới đây nói về thiết bị mạng nào?',
                imageNote: '(Hình ảnh gốc cho câu 27: Cáp quang)',
                options: ['Modem', 'Cáp quang', 'Cáp xoắn', 'Switch'],
                answer: 'Cáp quang' // Đáp án B
            },
            {
                type: 'mc',
                question: '28. Hình dưới đây nói về thiết bị mạng nào?',
                imageNote: '(Hình ảnh gốc cho câu 28: Cáp xoắn)',
                options: ['Modem', 'Cáp quang', 'Cáp xoắn', 'Switch'],
                answer: 'Cáp xoắn' // Đáp án C
            },
            {
                type: 'mc',
                question: '29. Em hãy cho biết 1 MB = ? KB',
                options: ['1024', '1022', '1025', '1023'],
                answer: '1024' // Đáp án A
            },
            {
                type: 'mc',
                question: '30. Xe cứu thương phát còi tín hiệu để người tham gia giao thông nhường đường. Em hãy cho biết thông tin đó có dạng gì?',
                options: ['Hình ảnh', 'Âm thanh', 'Hình ảnh và âm thanh', 'Chữ và âm thanh'],
                answer: 'Âm thanh' // *** ĐÃ SỬA *** (Đáp án B)
            },
            // --- Phần II: Trắc nghiệm Đúng/Sai (Từ ảnh 3 & 4) ---
            {
                type: 'tf',
                question: 'PHẦN II - Câu 1: Trong giờ Tin học, giáo viên yêu cầu chỉ ra đâu không phải là ưu điểm của mạng không dây. Các bạn HS đưa ra các ý kiến sau đây: (Đánh giá tính đúng/sai của các phát biểu)',
                statements: [
                    { text: 'A. Kết nối nhanh chóng, tiện lợi, dễ dàng thêm thiết bị mới', answer: true },
                    { text: 'B. Tín hiệu mạng ổn định, không bị ảnh hưởng bởi yếu tố thời tiết.', answer: false },
                    { text: 'C. Không cần dây cáp.', answer: true },
                    { text: 'D. Không hạn chế số lượng thiết bị kết nối.', answer: true } // *** ĐÃ SỬA ***
                ]
            },
            {
                type: 'tf',
                question: 'PHẦN II - Câu 2: Trong lớp học, cô giáo đặt câu hỏi An xung phong trả lời câu hỏi; sau khi nghe cô giáo giảng bài An đã cẩn thận ghi chép nội dung bài vào tập. Bạn An đã thực hiện những việc làm nào sau đây:',
                statements: [
                    { text: 'A. Lưu trữ thông tin', answer: true },
                    { text: 'B. Trao đổi thông tin', answer: true },
                    { text: 'C. Tra cứu thông tin', answer: false },
                    { text: 'D. Đọc dữ liệu', answer: false }
                ]
            },
            {
                type: 'tf',
                question: 'PHẦN II - Câu 3: Chọn phát biểu đúng/sai trong các câu bên dưới',
                statements: [
                    { text: 'A. Các dòng chữ trên trang sách là dữ liệu chữ và số.', answer: true },
                    { text: 'B. Hình ảnh in trên báo là dữ liệu hình ảnh.', answer: true },
                    { text: 'C. Băng ghi âm chứa dữ liệu chữ.', answer: false },
                    { text: 'D. Băng ghi âm chứa dữ liệu âm thanh.', answer: true }
                ]
            },
            {
                type: 'tf',
                question: 'PHẦN II - Câu 4: Chọn phát biểu đúng/sai trong các câu bên dưới',
                statements: [
                    { text: 'A. Mạng có dây là mạng dùng dây cáp để truyền dữ liệu', answer: true },
                    { text: 'B. Thiết bị cơ bản của mạng có dây: cáp mạng và Switch.', answer: true },
                    { text: 'C. Mạng có dây truyền tín hiệu bằng sóng điện từ', answer: false },
                    { text: 'D. Dùng mạng có dây sẽ thuận tiện hơn cho việc di chuyển', answer: false }
                ]
            },
            // --- Phần III: Tự luận (Từ ảnh 4) ---
            {
                type: 'short',
                question: 'PHẦN III - Câu 1: Dựa vào hình ảnh bên dưới em hãy cho biết tên các thiết bị và phần mềm có trong ảnh?',
                imageNote: '(Hình ảnh gốc cho câu III.1: Sơ đồ mạng Modem, Switch, PC, v.v.)',
                keywords: ['modem', 'switch', 'máy tính', 'google chrome', 'windows 10', 'facebook'],
                explanation: 'Thiết bị: Modem, Switch, máy tính. <br>Phần mềm: Google Chrome, Windows 10, facebook.'
            },
            {
                type: 'fill',
                question: 'PHẦN III - Câu 2: Hoàn thành bảng bên dưới: Thực hành đổi đơn vị dữ liệu',
                fills: [
                    { q: '1 Byte =', a: '8', s: 'Bit' },
                    { q: '1 KB =', a: '1024', s: 'B' },
                    { q: '2 KB =', a: '2048', s: 'B' },
                    { q: '1 MB =', a: '1024', s: 'KB' }
                ]
            },
            {
                type: 'short',
                question: 'PHẦN III - Câu 3: Nêu ba thành phần của mạng máy tính?',
                // *** ĐÃ SỬA ***
                keywords: ['máy tính', 'thiết bị', 'gửi', 'nhận', 'thiết bị mạng', 'kết nối', 'phần mềm', 'giao tiếp', 'truyền thông tin'],
                explanation: '- các máy tính và thiết bị có khả năng gửi và nhận thông tin qua mạng<br>- các thiết bị mạng có chức năng kết nối các máy tính với nhau<br>- những phần mềm giúp giao tiếp và truyền thông tin qua mạng'
            },
            {
                type: 'short',
                question: 'PHẦN III - Câu 4: Chu trình xử lí thông tin có mấy bước? Liệt kê?',
                keywords: ['3', 'xử lí đầu vào', 'xử lí dữ liệu', 'xử lí đầu ra'],
                explanation: 'Gồm 3 bước: <br>1. Xử lí đầu vào (Nhận thông tin) <br>2. Xử lí dữ liệu (Xử lí thông tin) <br>3. Xử lí đầu ra (Xuất thông tin)'
            }
        ];
        
        let quizData = JSON.parse(JSON.stringify(originalQuizData));
        
        // --- BIẾN TRẠNG THÁI ---
        let questionStatus = []; // Mảng lưu trạng thái: null, 'correct', 'incorrect'
        let incorrectQuestions = new Set(); // Set lưu index của các câu sai

        // --- DOM ELEMENTS ---
        const quizContainer = document.getElementById('quiz-container');
        const progressText = document.getElementById('progress-text');
        const scoreTracker = document.getElementById('score-tracker');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const totalResetBtn = document.getElementById('total-reset-btn');

        // --- CHỨC NĂNG KHỞI TẠO ---
        
        /**
         * Khởi tạo toàn bộ bài quiz
         */
        function initQuiz() {
            quizContainer.innerHTML = '';
            questionStatus = new Array(quizData.length).fill(null);
            incorrectQuestions.clear();

            quizData.forEach((question, index) => {
                const card = document.createElement('div');
                card.className = 'quiz-card relative';
                card.dataset.index = index;

                // Nút Reset cho từng câu
                const resetBtn = document.createElement('button');
                resetBtn.className = 'question-reset-btn';
                resetBtn.title = 'Làm lại câu này';
                resetBtn.innerHTML = '<i class="fas fa-sync-alt fa-sm"></i>';
                resetBtn.onclick = () => resetQuestion(index);
                card.appendChild(resetBtn);

                // Tiêu đề câu hỏi
                const questionTitle = document.createElement('h2');
                questionTitle.className = 'text-xl font-semibold mb-2 pr-10'; // Thêm padding để không bị che bởi nút reset
                questionTitle.innerHTML = question.question;
                card.appendChild(questionTitle);

                // Gợi ý hình ảnh (nếu có)
                if (question.imageNote) {
                    const note = document.createElement('p');
                    note.innerText = question.imageNote;
                    note.className = 'text-sm text-gray-500 italic mb-4';
                    card.appendChild(note);
                }

                // Tạo nội dung câu hỏi
                switch (question.type) {
                    case 'mc':
                        createMultipleChoice(question, index, card);
                        break;
                    case 'tf':
                        createTrueFalse(question, index, card);
                        break;
                    case 'short':
                        createShortAnswer(question, index, card);
                        break;
                    case 'fill':
                        createFillInBlank(question, index, card);
                        break;
                }
                
                quizContainer.appendChild(card);
            });

            updateProgress();
        }

        // --- CÁC HÀM TẠO CÂU HỎI ---

        function createMultipleChoice(question, index, card) {
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'space-y-3';
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.className = 'option-btn w-full text-left p-4 my-2 rounded-lg border border-gray-300 hover:bg-gray-100';
                button.onclick = () => checkMultipleChoice(button, option, question.answer, index);
                optionsContainer.appendChild(button);
            });
            card.appendChild(optionsContainer);
        }
        
        function createTrueFalse(question, index, card) {
            const statementsContainer = document.createElement('div');
            statementsContainer.className = 'space-y-4';
            statementsContainer.dataset.type = 'tf-container';

            question.statements.forEach((statement, s_index) => {
                const group = document.createElement('div');
                group.className = 'p-4 border border-gray-200 rounded-lg';
                
                const text = document.createElement('p');
                text.className = 'mb-3 font-medium';
                text.innerText = statement.text;
                group.appendChild(text);

                const buttonGroup = document.createElement('div');
                buttonGroup.className = 'flex gap-4';
                
                const trueId = `tf-${index}-${s_index}-true`;
                const falseId = `tf-${index}-${s_index}-false`;
                const name = `tf-group-${index}-${s_index}`;

                // Nút Đúng
                buttonGroup.innerHTML += `
                    <input type="radio" id="${trueId}" name="${name}" value="true" class="tf-input">
                    <label for="${trueId}" class="tf-label">Đúng</label>
                `;
                // Nút Sai
                buttonGroup.innerHTML += `
                    <input type="radio" id="${falseId}" name="${name}" value="false" class="tf-input">
                    <label for="${falseId}" class="tf-label">Sai</label>
                `;
                
                group.appendChild(buttonGroup);
                statementsContainer.appendChild(group);
            });
            card.appendChild(statementsContainer);
            
            // Nút kiểm tra cho TF
            const checkBtn = document.createElement('button');
            checkBtn.innerText = 'Kiểm tra';
            checkBtn.className = 'check-btn mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow transition duration-200';
            checkBtn.onclick = () => checkTrueFalse(question, index);
            card.appendChild(checkBtn);
        }
        
        function createShortAnswer(question, index, card) {
            const input = document.createElement('textarea');
            input.className = 'short-answer-input w-full p-3 border border-gray-300 rounded-lg h-32 focus:ring-2 focus:ring-blue-500 focus:outline-none';
            input.placeholder = 'Nhập câu trả lời của bạn...';
            card.appendChild(input);
            
            // Nút kiểm tra
            const checkBtn = document.createElement('button');
            checkBtn.innerText = 'Kiểm tra';
            checkBtn.className = 'check-btn mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow transition duration-200';
            checkBtn.onclick = () => checkShortAnswer(question, index);
            card.appendChild(checkBtn);
            
            // Nơi hiển thị đáp án
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'explanation-div mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hidden';
            card.appendChild(explanationDiv);
        }
        
        function createFillInBlank(question, index, card) {
            const fillContainer = document.createElement('div');
            fillContainer.className = 'space-y-3';
            fillContainer.dataset.type = 'fill-container';
            
            question.fills.forEach((fill, f_index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2';
                div.innerHTML = `
                    <label class="font-medium">${fill.q}</label>
                    <input type="text" data-index="${f_index}" class="short-answer-input w-24 p-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <span class="font-medium">${fill.s}</span>
                `;
                fillContainer.appendChild(div);
            });
            card.appendChild(fillContainer);
            
            // Nút kiểm tra
            const checkBtn = document.createElement('button');
            checkBtn.innerText = 'Kiểm tra';
            checkBtn.className = 'check-btn mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow transition duration-200';
            checkBtn.onclick = () => checkFillInBlank(question, index);
            card.appendChild(checkBtn);
        }

        // --- CÁC HÀM KIỂM TRA ĐÁP ÁN ---

        function checkMultipleChoice(clickedButton, selectedOption, correctAnswer, index) {
            if (questionStatus[index] !== null) return; // Đã trả lời

            const card = clickedButton.closest('.quiz-card');
            const allButtons = card.querySelectorAll('.option-btn');
            
            allButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.innerText === correctAnswer) {
                    btn.classList.add('correct');
                }
            });

            if (selectedOption === correctAnswer) {
                clickedButton.classList.add('correct');
                questionStatus[index] = 'correct';
                incorrectQuestions.delete(index);
            } else {
                clickedButton.classList.add('incorrect');
                questionStatus[index] = 'incorrect';
                incorrectQuestions.add(index);
            }
            
            updateProgress();
        }
        
        function checkTrueFalse(question, index) {
            if (questionStatus[index] !== null) return;

            const card = quizContainer.querySelector(`.quiz-card[data-index='${index}']`);
            let allCorrect = true;
            
            question.statements.forEach((statement, s_index) => {
                const name = `tf-group-${index}-${s_index}`;
                const selectedRadio = card.querySelector(`input[name='${name}']:checked`);
                
                const trueLabel = card.querySelector(`label[for='tf-${index}-${s_index}-true']`);
                const falseLabel = card.querySelector(`label[for='tf-${index}-${s_index}-false']`);
                
                let userAnswer = null;
                if (selectedRadio) {
                    userAnswer = (selectedRadio.value === 'true');
                } else {
                    allCorrect = false; // Bỏ lỡ
                }
                
                if (statement.answer === true) {
                    trueLabel.classList.add('correct');
                    if (userAnswer === false) {
                        falseLabel.classList.add('incorrect');
                        allCorrect = false;
                    }
                } else {
                    falseLabel.classList.add('correct');
                    if (userAnswer === true) {
                        trueLabel.classList.add('incorrect');
                        allCorrect = false;
                    }
                }
                
                // Vô hiệu hóa
                card.querySelector(`#tf-${index}-${s_index}-true`).disabled = true;
                card.querySelector(`#tf-${index}-${s_index}-false`).disabled = true;
            });
            
            card.querySelector('.check-btn').classList.add('hidden');
            
            if (allCorrect) {
                questionStatus[index] = 'correct';
                incorrectQuestions.delete(index);
            } else {
                questionStatus[index] = 'incorrect';
                incorrectQuestions.add(index);
            }
            
            updateProgress();
        }

        function checkShortAnswer(question, index) {
            if (questionStatus[index] !== null) return;

            const card = quizContainer.querySelector(`.quiz-card[data-index='${index}']`);
            const input = card.querySelector('textarea');
            const userAnswer = input.value.toLowerCase().trim().replace(/-\s/g, ''); // Xóa gạch đầu dòng và khoảng trắng
            input.disabled = true;

            let allKeywordsFound = true;
            if (userAnswer === "") {
                allKeywordsFound = false;
            } else {
                question.keywords.forEach(keyword => {
                    if (!userAnswer.includes(keyword.toLowerCase())) {
                        allKeywordsFound = false;
                    }
                });
            }

            const explanationDiv = card.querySelector('.explanation-div');
            explanationDiv.innerHTML = `<strong>Đáp án gợi ý:</strong><br>${question.explanation}`;
            explanationDiv.classList.remove('hidden');
            card.querySelector('.check-btn').classList.add('hidden');

            if (allKeywordsFound) {
                input.classList.add('correct');
                questionStatus[index] = 'correct';
                incorrectQuestions.delete(index);
            } else {
                input.classList.add('incorrect');
                questionStatus[index] = 'incorrect';
                incorrectQuestions.add(index);
            }
            
            updateProgress();
        }
        
        function checkFillInBlank(question, index) {
            if (questionStatus[index] !== null) return;
            
            const card = quizContainer.querySelector(`.quiz-card[data-index='${index}']`);
            let allCorrect = true;
            
            question.fills.forEach((fill, f_index) => {
                const input = card.querySelector(`input[data-index='${f_index}']`);
                const userAnswer = input.value.trim();
                input.disabled = true;
                
                if (userAnswer === fill.a) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                    allCorrect = false;
                }
            });
            
            card.querySelector('.check-btn').classList.add('hidden');
            
            if (allCorrect) {
                questionStatus[index] = 'correct';
                incorrectQuestions.delete(index);
            } else {
                questionStatus[index] = 'incorrect';
                incorrectQuestions.add(index);
            }
            
            updateProgress();
        }
        
        // --- CÁC HÀM TIỆN ÍCH ---

        /**
         * Đặt lại một câu hỏi cụ thể
         */
        function resetQuestion(index) {
            const card = quizContainer.querySelector(`.quiz-card[data-index='${index}']`);
            if (!card) return;
            
            // Reset trạng thái
            const wasIncorrect = questionStatus[index] === 'incorrect';
            questionStatus[index] = null;
            // Cập nhật lại set câu sai nếu câu này trước đó sai
            if (wasIncorrect) {
                incorrectQuestions.delete(index);
            }
            
            // Reset MC
            card.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
                btn.disabled = false;
            });
            
            // Reset TF
            card.querySelectorAll('.tf-input').forEach(input => {
                input.checked = false;
                input.disabled = false;
            });
            card.querySelectorAll('.tf-label').forEach(label => {
                label.classList.remove('correct', 'incorrect');
            });

            // Reset Short Answer
            card.querySelectorAll('textarea').forEach(input => {
                input.value = '';
                input.disabled = false;
                input.classList.remove('correct', 'incorrect');
            });
            card.querySelectorAll('.explanation-div').forEach(div => {
                div.classList.add('hidden');
                div.innerHTML = '';
            });
            
            // Reset Fill
            card.querySelectorAll('input[type="text"]').forEach(input => {
                input.value = '';
                input.disabled = false;
                input.classList.remove('correct', 'incorrect');
            });

            // Hiện lại nút Check (nếu có)
            card.querySelectorAll('.check-btn').forEach(btn => {
                btn.classList.remove('hidden');
            });

            updateProgress();
        }

        /**
         * Cập nhật thanh tiến độ
         */
        function updateProgress() {
            const completedCount = questionStatus.filter(s => s !== null).length;
            progressText.innerText = `Đã hoàn thành: ${completedCount} / ${quizData.length}`;
            
            const incorrectCount = incorrectQuestions.size;
            scoreTracker.innerText = `Câu sai: ${incorrectCount}`;
        }

        /**
         * Xáo trộn câu hỏi và đáp án
         */
        function shuffleQuiz() {
            // Xáo trộn quizData
            quizData.sort(() => Math.random() - 0.5);
            
            // Xáo trộn đáp án MC
            quizData.forEach(question => {
                if (question.type === 'mc' && question.options) {
                    question.options.sort(() => Math.random() - 0.5);
                }
            });
            
            initQuiz();
        }

        /**
         * Reset tổng
         */
        function totalReset() {
            // Khôi phục dữ liệu gốc (nếu đã bị xáo trộn)
            quizData = JSON.parse(JSON.stringify(originalQuizData));
            initQuiz();
        }

        // --- EVENT LISTENERS ---
        shuffleBtn.addEventListener('click', shuffleQuiz);
        totalResetBtn.addEventListener('click', totalReset);

        // --- BẮT ĐẦU QUIZ ---
        document.addEventListener('DOMContentLoaded', initQuiz);

    </script>
</body>
</html>
